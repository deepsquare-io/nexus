import { _optionalChain } from '@sentry/utils/esm/buildPolyfills';
import { getCurrentHub } from '@sentry/core';
import { withEdgeWrapping } from './utils/edgeWrapperUtils.js';

/**
 * Wraps a Next.js edge route handler with Sentry error and performance instrumentation.
 */
function wrapApiHandlerWithSentry(
  handler,
  parameterizedRoute,
) {
  return new Proxy(handler, {
    apply: async (wrappingTarget, thisArg, args) => {
      const req = args[0];

      const activeSpan = !!_optionalChain([getCurrentHub, 'call', _ => _(), 'access', _2 => _2.getScope, 'call', _3 => _3(), 'optionalAccess', _4 => _4.getSpan, 'call', _5 => _5()]);

      const wrappedHandler = withEdgeWrapping(wrappingTarget, {
        spanDescription:
          activeSpan || !(req instanceof Request)
            ? `handler (${parameterizedRoute})`
            : `${req.method} ${parameterizedRoute}`,
        spanOp: activeSpan ? 'function' : 'http.server',
        mechanismFunctionName: 'wrapApiHandlerWithSentry',
      });

      return await wrappedHandler.apply(thisArg, args);
    },
  });
}

/**
 * @deprecated Use `wrapApiHandlerWithSentry` instead.
 */
const withSentryAPI = wrapApiHandlerWithSentry;

export { withSentryAPI, wrapApiHandlerWithSentry };
//# sourceMappingURL=wrapApiHandlerWithSentry.js.map
